import{u as w,r as a,j as f}from"./components-BmgQfFUx.js";const p="preview-updates";function m(){const{previewId:s}=w(),e=a.useRef(null),t=a.useRef(),[r,d]=a.useState(""),i=a.useCallback(()=>{e.current&&r&&(e.current.src="",requestAnimationFrame(()=>{e.current&&(e.current.src=r)}))},[r]),l=a.useCallback(()=>{if(e.current&&r){const c=new URL(r);c.searchParams.set("_t",Date.now().toString()),e.current.src="",requestAnimationFrame(()=>{e.current&&(e.current.src=c.toString())})}},[r]),o=a.useCallback(()=>{t.current&&r&&t.current.postMessage({type:"preview-ready",previewId:s,url:r,timestamp:Date.now()})},[s,r]);return a.useEffect(()=>{typeof window<"u"&&typeof window.BroadcastChannel=="function"?(t.current=new window.BroadcastChannel(p),t.current.onmessage=n=>{n.data.previewId===s&&(n.data.type==="hard-refresh"?l():(n.data.type==="refresh-preview"||n.data.type==="file-change")&&i())}):t.current=void 0;const u=`https://${s}.local-credentialless.webcontainer-api.io`;return d(u),e.current&&(e.current.src=u),o(),()=>{t.current?.close()}},[s,i,l,o]),f.jsx("div",{className:"w-full h-full",children:f.jsx("iframe",{ref:e,title:"WebContainer Preview",className:"w-full h-full border-none",sandbox:"allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation allow-same-origin",allow:"cross-origin-isolated",loading:"eager",onLoad:o})})}export{m as default};
