import{r as u,j as e}from"./components-BmgQfFUx.js";import{aD as S,m as f,aS as L}from"./Header-C4AWQck-.js";import{c as v,B as j,a as P}from"./Button-BQzjmXH6.js";import"./logs-DZu2vR68.js";import"./mobile-BXmnRaCS.js";function k({connectionTest:t,onTestConnection:x}){const{isConnected:o,isConnecting:a,connection:l,error:p,connect:s,disconnect:d}=S(),[i,m]=u.useState(""),[n,r]=u.useState("https://gitlab.com"),b=async g=>{if(g.preventDefault(),console.log("GitLab connect attempt:",{token:i?`${i.substring(0,10)}...`:"empty",gitlabUrl:n,tokenLength:i.length}),!i.trim()){console.log("Token is empty, not attempting connection");return}try{console.log("Calling connect function..."),await s(i,n),console.log("Connect function completed successfully"),m("")}catch(w){console.error("GitLab connect failed:",w)}},h=()=>{d(),P.success("Disconnected from GitLab")};return e.jsx(f.div,{className:"bg-bolt-elements-background border border-bolt-elements-borderColor rounded-lg",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 text-orange-600",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:e.jsx("path",{fill:"currentColor",d:"M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"})})}),e.jsx("h3",{className:"text-base font-medium text-bolt-elements-textPrimary",children:"GitLab Connection"})]})}),!o&&e.jsxs("div",{className:"text-xs text-bolt-elements-textSecondary bg-bolt-elements-background-depth-1 p-3 rounded-lg mb-4",children:[e.jsxs("p",{className:"flex items-center gap-1 mb-1",children:[e.jsx("span",{className:"i-ph:lightbulb w-3.5 h-3.5 text-bolt-elements-icon-success"}),e.jsx("span",{className:"font-medium",children:"Tip:"})," You can also set the"," ",e.jsx("code",{className:"px-1 py-0.5 bg-bolt-elements-background-depth-2 rounded",children:"VITE_GITLAB_ACCESS_TOKEN"})," ","environment variable to connect automatically."]}),e.jsxs("p",{children:["For self-hosted GitLab instances, also set"," ",e.jsx("code",{className:"px-1 py-0.5 bg-bolt-elements-background-depth-2 rounded",children:"VITE_GITLAB_URL=https://your-gitlab-instance.com"})]})]}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-bolt-elements-textSecondary mb-2",children:"GitLab URL"}),e.jsx("input",{type:"text",value:n,onChange:g=>r(g.target.value),disabled:a||o,placeholder:"https://gitlab.com",className:v("w-full px-3 py-2 rounded-lg text-sm","bg-bolt-elements-background-depth-1","border border-bolt-elements-borderColor","text-bolt-elements-textPrimary placeholder-bolt-elements-textTertiary","focus:outline-none focus:ring-1 focus:ring-bolt-elements-borderColorActive","disabled:opacity-50")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-bolt-elements-textSecondary mb-2",children:"Access Token"}),e.jsx("input",{type:"password",value:i,onChange:g=>m(g.target.value),disabled:a||o,placeholder:"Enter your GitLab access token",className:v("w-full px-3 py-2 rounded-lg text-sm","bg-bolt-elements-background-depth-1","border border-bolt-elements-borderColor","text-bolt-elements-textPrimary placeholder-bolt-elements-textTertiary","focus:outline-none focus:ring-1 focus:ring-bolt-elements-borderColorActive","disabled:opacity-50")}),e.jsxs("div",{className:"mt-2 text-sm text-bolt-elements-textSecondary",children:[e.jsxs("a",{href:`${n}/-/user_settings/personal_access_tokens`,target:"_blank",rel:"noopener noreferrer",className:"text-bolt-elements-borderColorActive hover:underline inline-flex items-center gap-1",children:["Get your token",e.jsx("div",{className:"i-ph:arrow-square-out w-4 h-4"})]}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx("span",{children:"Required scopes: api, read_repository"})]})]})]}),p&&e.jsx("div",{className:"p-4 rounded-lg bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-700",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:p})}),e.jsx("div",{className:"flex items-center justify-between",children:o?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:h,className:v("px-4 py-2 rounded-lg text-sm flex items-center gap-2","bg-red-500 text-white","hover:bg-red-600"),children:[e.jsx("div",{className:"i-ph:plug w-4 h-4"}),"Disconnect"]}),e.jsxs("span",{className:"text-sm text-bolt-elements-textSecondary flex items-center gap-1",children:[e.jsx("div",{className:"i-ph:check-circle w-4 h-4 text-green-500"}),"Connected to GitLab"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>window.open(`${l?.gitlabUrl||"https://gitlab.com"}/dashboard`,"_blank","noopener,noreferrer"),className:"flex items-center gap-2 hover:bg-bolt-elements-item-backgroundActive/10 hover:text-bolt-elements-textPrimary dark:hover:text-bolt-elements-textPrimary transition-colors",children:[e.jsx("div",{className:"i-ph:layout w-4 h-4"}),"Dashboard"]}),e.jsx(j,{onClick:x,disabled:t?.status==="testing",variant:"outline",className:"flex items-center gap-2 hover:bg-bolt-elements-item-backgroundActive/10 hover:text-bolt-elements-textPrimary dark:hover:text-bolt-elements-textPrimary transition-colors",children:t?.status==="testing"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-ph:spinner-gap w-4 h-4 animate-spin"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-ph:plug-charging w-4 h-4"}),"Test Connection"]})})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"submit",disabled:a||!i.trim(),className:v("px-4 py-2 rounded-lg text-sm flex items-center gap-2","bg-[#FC6D26] text-white","hover:bg-[#E24329] hover:text-white","disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200","transform active:scale-95"),children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-ph:spinner-gap animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"i-ph:plug-charging w-4 h-4"}),"Connect"]})}),e.jsx("button",{type:"button",onClick:()=>console.log("Manual test:",{token:i?`${i.substring(0,10)}...`:"empty",gitlabUrl:n}),className:"px-4 py-2 rounded-lg text-sm bg-gray-500 text-white hover:bg-gray-600",children:"Test Values"})]})})]})]})})}function G({stats:t,onRefresh:x,isRefreshing:o}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-bolt-elements-textPrimary mb-2",children:"Repository Stats"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:[{label:"Public Repos",value:t.publicProjects},{label:"Private Repos",value:t.privateProjects}].map((a,l)=>e.jsxs("div",{className:"flex flex-col p-3 rounded-lg bg-bolt-elements-background-depth-2 border border-bolt-elements-borderColor",children:[e.jsx("span",{className:"text-xs text-bolt-elements-textSecondary",children:a.label}),e.jsx("span",{className:"text-lg font-medium text-bolt-elements-textPrimary",children:a.value})]},l))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-bolt-elements-textPrimary mb-2",children:"Contribution Stats"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:[{label:"Stars",value:t.stars||0,icon:"i-ph:star",iconColor:"text-bolt-elements-icon-warning"},{label:"Forks",value:t.forks||0,icon:"i-ph:git-fork",iconColor:"text-bolt-elements-icon-info"},{label:"Followers",value:t.followers||0,icon:"i-ph:users",iconColor:"text-bolt-elements-icon-success"}].map((a,l)=>e.jsxs("div",{className:"flex flex-col p-3 rounded-lg bg-bolt-elements-background-depth-2 border border-bolt-elements-borderColor",children:[e.jsx("span",{className:"text-xs text-bolt-elements-textSecondary",children:a.label}),e.jsxs("span",{className:"text-lg font-medium text-bolt-elements-textPrimary flex items-center gap-1",children:[e.jsx("div",{className:`${a.icon} w-4 h-4 ${a.iconColor}`}),a.value]})]},l))})]}),e.jsx("div",{className:"pt-2 border-t border-bolt-elements-borderColor",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-bolt-elements-textSecondary",children:["Last updated: ",new Date(t.lastUpdated).toLocaleString()]}),x&&e.jsx(j,{onClick:x,disabled:o,variant:"outline",size:"sm",className:"text-xs",children:o?"Refreshing...":"Refresh"})]})})]})}const C=20;function A({repositories:t,onClone:x,onRefresh:o,isRefreshing:a}){const[l,p]=u.useState(""),[s,d]=u.useState(1),[i,m]=u.useState(!1),n=u.useMemo(()=>{if(!l)return t;m(!0);const c=t.filter(y=>y.name.toLowerCase().includes(l.toLowerCase())||y.path_with_namespace.toLowerCase().includes(l.toLowerCase())||y.description&&y.description.toLowerCase().includes(l.toLowerCase()));return m(!1),c},[t,l]),r=Math.ceil(n.length/C),b=(s-1)*C,h=b+C,g=n.slice(b,h),w=c=>{p(c),d(1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-bolt-elements-textPrimary",children:["Repositories (",n.length,")"]}),o&&e.jsxs(j,{onClick:o,disabled:a,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[a?e.jsx("div",{className:"i-ph:spinner animate-spin w-4 h-4"}):e.jsx("div",{className:"i-ph:arrows-clockwise w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search repositories...",value:l,onChange:c=>w(c.target.value),className:"w-full px-4 py-2 pl-10 rounded-lg bg-bolt-elements-background-depth-2 border border-bolt-elements-borderColor text-bolt-elements-textPrimary placeholder-bolt-elements-textTertiary focus:outline-none focus:ring-1 focus:ring-bolt-elements-borderColorActive"}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:i?e.jsx("div",{className:"i-ph:spinner animate-spin w-4 h-4 text-bolt-elements-textSecondary"}):e.jsx("div",{className:"i-ph:magnifying-glass w-4 h-4 text-bolt-elements-textSecondary"})})]}),e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsx("div",{className:"text-center py-8 text-bolt-elements-textSecondary",children:l?"No repositories found matching your search.":"No repositories available."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(c=>e.jsx(L,{repo:c,onClone:x},c.id))}),r>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-bolt-elements-borderColor",children:[e.jsxs("div",{className:"text-sm text-bolt-elements-textSecondary",children:["Showing ",Math.min(b+1,n.length)," to"," ",Math.min(h,n.length)," of ",n.length," repositories"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{onClick:()=>d(c=>Math.max(1,c-1)),disabled:s===1,variant:"outline",size:"sm",children:[e.jsx("div",{className:"i-ph:caret-left w-4 h-4"}),"Previous"]}),e.jsxs("span",{className:"text-sm text-bolt-elements-textSecondary px-3",children:[s," of ",r]}),e.jsxs(j,{onClick:()=>d(c=>Math.min(r,c+1)),disabled:s===r,variant:"outline",size:"sm",children:["Next",e.jsx("div",{className:"i-ph:caret-right w-4 h-4"})]})]})]})]})})]})}const N=()=>e.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",children:e.jsx("path",{fill:"currentColor",d:"M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"})});function F(){const{connection:t,isConnected:x,isLoading:o,error:a,testConnection:l,refreshStats:p}=S(),[s,d]=u.useState(null),[i,m]=u.useState(!1),n=async()=>{if(!t?.user){d({status:"error",message:"No connection established",timestamp:Date.now()});return}d({status:"testing",message:"Testing connection..."});try{const r=await l();d(r?{status:"success",message:`Connected successfully as ${t.user.username}`,timestamp:Date.now()}:{status:"error",message:"Connection test failed",timestamp:Date.now()})}catch(r){d({status:"error",message:`Connection failed: ${r instanceof Error?r.message:"Unknown error"}`,timestamp:Date.now()})}};return o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{}),e.jsx("h2",{className:"text-lg font-medium text-bolt-elements-textPrimary",children:"GitLab Integration"})]}),e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"i-ph:spinner-gap-bold animate-spin w-4 h-4"}),e.jsx("span",{className:"text-bolt-elements-textSecondary",children:"Loading..."})]})})]}):a&&!t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{}),e.jsx("h2",{className:"text-lg font-medium text-bolt-elements-textPrimary",children:"GitLab Integration"})]}),e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400 p-3 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:a})]}):!x||!t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{}),e.jsx("h2",{className:"text-lg font-medium text-bolt-elements-textPrimary",children:"GitLab Integration"})]}),e.jsx("p",{className:"text-sm text-bolt-elements-textSecondary",children:"Connect your GitLab account to enable advanced repository management features, statistics, and seamless integration."}),e.jsx(k,{connectionTest:s,onTestConnection:n})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f.div,{className:"flex items-center justify-between gap-2",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{}),e.jsx("h2",{className:"text-lg font-medium text-bolt-elements-textPrimary dark:text-bolt-elements-textPrimary",children:"GitLab Integration"})]}),e.jsx("div",{className:"flex items-center gap-2",children:t?.rateLimit&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-bolt-elements-background-depth-1 rounded-lg text-xs",children:[e.jsx("div",{className:"i-ph:cloud w-4 h-4 text-bolt-elements-textSecondary"}),e.jsxs("span",{className:"text-bolt-elements-textSecondary",children:["API: ",t.rateLimit.remaining,"/",t.rateLimit.limit]})]})})]}),e.jsx("p",{className:"text-sm text-bolt-elements-textSecondary dark:text-bolt-elements-textSecondary",children:"Manage your GitLab integration with advanced repository features and comprehensive statistics"}),s&&e.jsx("div",{className:`p-3 rounded-lg border ${s.status==="success"?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":s.status==="error"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 ${s.status==="success"?"text-green-600":s.status==="error"?"text-red-600":"text-blue-600"}`,children:s.status==="success"?e.jsx("div",{className:"i-ph:check-circle"}):s.status==="error"?e.jsx("div",{className:"i-ph:x-circle"}):e.jsx("div",{className:"i-ph:spinner animate-spin"})}),e.jsx("span",{className:`text-sm ${s.status==="success"?"text-green-800 dark:text-green-200":s.status==="error"?"text-red-800 dark:text-red-200":"text-blue-800 dark:text-blue-200"}`,children:s.message})]})}),e.jsx(k,{connectionTest:s,onTestConnection:n}),t?.user&&e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"border-t border-bolt-elements-borderColor pt-6",children:e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-bolt-elements-background-depth-1 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-2 border-bolt-elements-item-contentAccent flex items-center justify-center bg-bolt-elements-background-depth-2 overflow-hidden",children:t.user.avatar_url&&t.user.avatar_url!=="null"&&t.user.avatar_url!==""?e.jsx("img",{src:t.user.avatar_url,alt:t.user.username,className:"w-full h-full rounded-full object-cover",onError:r=>{const b=r.target;b.style.display="none";const h=b.parentElement;h&&(h.textContent=(t.user?.name||t.user?.username||"U").charAt(0).toUpperCase(),h.classList.add("text-white","font-semibold","text-sm","flex","items-center","justify-center"))}}):e.jsx("div",{className:"w-full h-full rounded-full bg-bolt-elements-item-contentAccent flex items-center justify-center text-white font-semibold text-sm",children:(t.user?.name||t.user?.username||"U").charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-bolt-elements-textPrimary",children:t.user?.name||t.user?.username}),e.jsx("p",{className:"text-sm text-bolt-elements-textSecondary",children:t.user?.username})]})]})}),t?.stats&&e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"border-t border-bolt-elements-borderColor pt-6",children:[e.jsx("h3",{className:"text-base font-medium text-bolt-elements-textPrimary mb-4",children:"Statistics"}),e.jsx(G,{stats:t.stats,onRefresh:async()=>{m(!0);try{await p()}catch(r){console.error("Failed to refresh stats:",r)}finally{m(!1)}},isRefreshing:i})]}),t?.stats?.projects&&e.jsx(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"border-t border-bolt-elements-borderColor pt-6",children:e.jsx(A,{repositories:t.stats.projects,onRefresh:async()=>{m(!0);try{await p()}catch(r){console.error("Failed to refresh repositories:",r)}finally{m(!1)}},isRefreshing:i})})]})}export{F as default};
