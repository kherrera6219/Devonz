const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GitHubDeploymentDialog-HKJ7qUwC.js","assets/components-BmgQfFUx.js","assets/Header-C4AWQck-.js","assets/Button-BQzjmXH6.js","assets/logs-DZu2vR68.js","assets/mobile-BXmnRaCS.js","assets/Header-BXPLhsMc.css","assets/Badge-Bv7eozhH.js","assets/Card-BJ5ZEwCc.js","assets/Switch-Ce5GRzG7.js","assets/StatusIndicator-BVCqogRq.js","assets/GitLabDeploymentDialog-CxNPU6BM.js","assets/formatSize-D-zwpqud.js"])))=>i.map(i=>d[i]);
import{_ as U}from"./logs-DZu2vR68.js";import{r as f,j as t}from"./components-BmgQfFUx.js";import{ax as _,a$ as J,b0 as q,b1 as K,b2 as M,b3 as Q,b4 as X,aT as z,aW as R,z as F,B,b5 as T,ay as V,b6 as oe,b7 as re,R as ie,T as se,P as le,C as ae,I as L}from"./Header-C4AWQck-.js";import{b as I,a as N,c as O}from"./Button-BQzjmXH6.js";import{n as W,f as ce}from"./netlify-chCXiqNy.js";import"./mobile-BXmnRaCS.js";function de(){const i=I(W),c=I(_);f.useEffect(()=>{i.token&&c&&ce(i.token)},[i.token,c]);const s=i.stats?.sites?.find(a=>a.name.includes(`bolt-diy-${c}`));return s?t.jsx(J,{children:t.jsxs(q,{children:[t.jsx(K,{asChild:!0,children:t.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-8 h-8 rounded hover:bg-bolt-elements-item-backgroundActive text-bolt-elements-textSecondary hover:text-[#00AD9F] z-50",onClick:a=>{a.stopPropagation()},children:t.jsx("div",{className:"i-ph:link w-4 h-4 hover:text-blue-400"})})}),t.jsx(M,{children:t.jsxs(Q,{className:"px-3 py-2 rounded bg-bolt-elements-background-depth-3 text-bolt-elements-textPrimary text-xs z-50",sideOffset:5,children:[s.url,t.jsx(X,{className:"fill-bolt-elements-background-depth-3"})]})})]})}):null}function ue(){const i=I(z),c=I(_),[s,a]=f.useState(null),[S,e]=f.useState(!1);return f.useEffect(()=>{async function d(){if(!i.token||!c)return;const o=localStorage.getItem(`vercel-project-${c}`);if(o){e(!0);try{const A=await R.get("/v9/projects",i.token);if(!A.success||!A.data)throw new Error(A.error||"Failed to fetch projects");const u=A.data.projects||[],r=c.split("-")[0],l=u.find(g=>g.name.includes(`bolt-diy-${r}`));if(l){const g=await R.get(`/v9/projects/${l.id}`,i.token);if(g.success&&g.data){const D=g.data;if(D.targets?.production?.alias&&D.targets.production.alias.length>0){const n=D.targets.production.alias.find(x=>x.endsWith(".vercel.app")&&!x.includes("-projects.vercel.app"));if(n){a(`https://${n}`);return}else{a(`https://${D.targets.production.alias[0]}`);return}}}const w=await R.get(`/v6/deployments?projectId=${l.id}&limit=1`,i.token);if(w.success&&w.data){const D=w.data;if(D.deployments&&D.deployments.length>0){a(`https://${D.deployments[0].url}`);return}}}const p=await(await fetch(`/api/vercel-deploy?projectId=${o}&token=${i.token}`,{method:"GET"})).json();p.deploy?.url?a(p.deploy.url):p.project?.url&&a(p.project.url)}catch(A){console.error("Error fetching Vercel deployment:",A)}finally{e(!1)}}}d()},[i.token,c]),s?t.jsx(J,{children:t.jsxs(q,{children:[t.jsx(K,{asChild:!0,children:t.jsx("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-8 h-8 rounded hover:bg-bolt-elements-item-backgroundActive text-bolt-elements-textSecondary hover:text-[#000000] z-50",onClick:d=>{d.stopPropagation()},children:t.jsx("div",{className:`i-ph:link w-4 h-4 hover:text-blue-400 ${S?"animate-pulse":""}`})})}),t.jsx(M,{children:t.jsxs(Q,{className:"px-3 py-2 rounded bg-bolt-elements-background-depth-3 text-bolt-elements-textPrimary text-xs z-50",sideOffset:5,children:[s,t.jsx(X,{className:"fill-bolt-elements-background-depth-3"})]})})]})}):null}function pe(){const[i,c]=f.useState(!1),s=I(z),a=I(_);return{isDeploying:i,handleVercelDeploy:async()=>{if(!s.user||!s.token)return N.error("Please connect to Vercel first in the settings tab!"),!1;if(!a)return N.error("No active chat found"),!1;try{c(!0);const e=F.firstArtifact;if(!e)throw new Error("No active project found");const d="deploy-vercel-project";F.addArtifact({id:d,messageId:d,title:"Vercel Deployment",type:"standalone"});const o=F.artifacts.get()[d];o.runner.handleDeployAction("building","running",{source:"vercel"});const A="build-"+Date.now(),u={messageId:"vercel build",artifactId:e.id,actionId:A,action:{type:"build",content:"npm run build"}};if(e.runner.addAction(u),await e.runner.runAction(u),!e.runner.buildOutput)throw o.runner.handleDeployAction("building","failed",{error:"Build failed. Check the terminal for details.",source:"vercel"}),new Error("Build failed");o.runner.handleDeployAction("deploying","running",{source:"vercel"});const r=await B,l=e.runner.buildOutput.path.replace("/home/project","");let C=l;const p=[l,"/dist","/build","/out","/output","/.next","/public"];let g=!1;for(const h of p)try{await r.fs.readdir(h),C=h,g=!0;break}catch{continue}if(!g)throw new Error("Could not find build output directory. Please check your build configuration.");async function w(h){const j={},b=await r.fs.readdir(h,{withFileTypes:!0});for(const k of b){const P=T.join(h,k.name);if(k.isFile()){const G=await r.fs.readFile(P,"utf-8"),E=P.replace(C,"");j[E]=G}else if(k.isDirectory()){const G=await w(P);Object.assign(j,G)}}return j}const D=await w(C),n={};async function x(h){const j=await r.fs.readdir(h,{withFileTypes:!0});for(const b of j){const k=T.join(h,b.name);if(b.isFile())try{const P=await r.fs.readFile(k,"utf-8");let G=k;k.startsWith("/home/project/")?G=k.replace("/home/project/",""):k.startsWith("./")&&(G=k.replace("./","")),n[G]=P}catch(P){console.log(`Skipping file ${b.name}: ${P}`)}else b.isDirectory()&&!b.name.startsWith(".")&&b.name!=="node_modules"&&await x(k)}}try{await x(".")}catch{await x("/home/project")}const y=localStorage.getItem(`vercel-project-${a}`),m=await fetch("/api/vercel-deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:y||void 0,files:D,sourceFiles:n,token:s.token,chatId:a})}),v=await m.json();if(!m.ok||!v.deploy||!v.project)throw console.error("Invalid deploy response:",v),o.runner.handleDeployAction("deploying","failed",{error:v.error||"Invalid deployment response",source:"vercel"}),new Error(v.error||"Invalid deployment response");return v.project&&localStorage.setItem(`vercel-project-${a}`,v.project.id),o.runner.handleDeployAction("complete","complete",{url:v.deploy.url,source:"vercel"}),N.success("ðŸš€ Vercel deployment completed successfully!"),!0}catch(e){return console.error("Vercel deploy error:",e),N.error(e instanceof Error?e.message:"Vercel deployment failed"),!1}finally{c(!1)}},isConnected:!!s.user}}function fe(){const[i,c]=f.useState(!1),s=I(W),a=I(_);return{isDeploying:i,handleNetlifyDeploy:async()=>{if(!s.user||!s.token)return N.error("Please connect to Netlify first in the settings tab!"),!1;if(!a)return N.error("No active chat found"),!1;try{c(!0);const e=F.firstArtifact;if(!e)throw new Error("No active project found");const d="deploy-artifact";F.addArtifact({id:d,messageId:d,title:"Netlify Deployment",type:"standalone"});const o=F.artifacts.get()[d];o.runner.handleDeployAction("building","running",{source:"netlify"});const A="build-"+Date.now(),u={messageId:"netlify build",artifactId:e.id,actionId:A,action:{type:"build",content:"npm run build"}};if(e.runner.addAction(u),await e.runner.runAction(u),!e.runner.buildOutput)throw o.runner.handleDeployAction("building","failed",{error:"Build failed. Check the terminal for details.",source:"netlify"}),new Error("Build failed");o.runner.handleDeployAction("deploying","running",{source:"netlify"});const r=await B,l=e.runner.buildOutput.path.replace("/home/project","");console.log("Original buildPath",l);let C=l;const p=[l,"/dist","/build","/out","/output","/.next","/public"];let g=!1;for(const j of p)try{await r.fs.readdir(j),C=j,g=!0,console.log(`Using build directory: ${C}`);break}catch(b){console.log(`Directory ${j} doesn't exist, trying next option. ${b}`);continue}if(!g)throw new Error("Could not find build output directory. Please check your build configuration.");async function w(j){const b={},k=await r.fs.readdir(j,{withFileTypes:!0});for(const P of k){const G=T.join(j,P.name);if(P.isFile()){const E=await r.fs.readFile(G,"utf-8"),H=G.replace(C,"");b[H]=E}else if(P.isDirectory()){const E=await w(G);Object.assign(b,E)}}return b}const D=await w(C),n=localStorage.getItem(`netlify-site-${a}`),x=await fetch("/api/netlify-deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:n||void 0,files:D,token:s.token,chatId:a})}),y=await x.json();if(!x.ok||!y.deploy||!y.site)throw console.error("Invalid deploy response:",y),o.runner.handleDeployAction("deploying","failed",{error:y.error||"Invalid deployment response",source:"netlify"}),new Error(y.error||"Invalid deployment response");const m=20;let v=0,h;for(;v<m;)try{if(h=await(await fetch(`https://api.netlify.com/api/v1/sites/${y.site.id}/deploys/${y.deploy.id}`,{headers:{Authorization:`Bearer ${s.token}`}})).json(),h.state==="ready"||h.state==="uploaded")break;if(h.state==="error")throw o.runner.handleDeployAction("deploying","failed",{error:"Deployment failed: "+(h.error_message||"Unknown error"),source:"netlify"}),new Error("Deployment failed: "+(h.error_message||"Unknown error"));v++,await new Promise(b=>setTimeout(b,1e3))}catch(j){console.error("Status check error:",j),v++,await new Promise(b=>setTimeout(b,2e3))}if(v>=m)throw o.runner.handleDeployAction("deploying","failed",{error:"Deployment timed out",source:"netlify"}),new Error("Deployment timed out");return y.site&&localStorage.setItem(`netlify-site-${a}`,y.site.id),o.runner.handleDeployAction("complete","complete",{url:h.ssl_url||h.url,source:"netlify"}),N.success("ðŸš€ Netlify deployment completed successfully!"),!0}catch(e){return console.error("Deploy error:",e),N.error(e instanceof Error?e.message:"Deployment failed"),!1}finally{c(!1)}},isConnected:!!s.user}}function ye(){const[i,c]=f.useState(!1),s=I(_);return{isDeploying:i,handleGitHubDeploy:async()=>{const S=V("github_connection");if(!S?.token||!S?.user)return N.error("Please connect your GitHub account in Settings > Connections first"),!1;if(!s)return N.error("No active chat found"),!1;try{c(!0);const e=F.firstArtifact;if(!e)throw new Error("No active project found");const d="deploy-github-project";F.addArtifact({id:d,messageId:d,title:"GitHub Deployment",type:"standalone"});const o=F.artifacts.get()[d];o.runner.handleDeployAction("building","running",{source:"github"});const A="build-"+Date.now(),u={messageId:"github build",artifactId:e.id,actionId:A,action:{type:"build",content:"npm run build"}};if(e.runner.addAction(u),await e.runner.runAction(u),!e.runner.buildOutput)throw o.runner.handleDeployAction("building","failed",{error:"Build failed. Check the terminal for details.",source:"github"}),new Error("Build failed");o.runner.handleDeployAction("deploying","running",{source:"github"});const r=await B;async function l(p,g=""){const w={},D=await r.fs.readdir(p,{withFileTypes:!0});for(const n of D){const x=T.join(p,n.name),y=g?`${g}/${n.name}`:n.name;if(!(n.isDirectory()&&(n.name==="node_modules"||n.name===".git"||n.name==="dist"||n.name==="build"||n.name===".cache"||n.name===".next"))){if(n.isFile()){if(n.name.endsWith(".DS_Store")||n.name.endsWith(".log")||n.name.startsWith(".env"))continue;try{const m=await r.fs.readFile(x,"utf-8");w[y]=m}catch(m){console.warn(`Could not read file ${x}:`,m);continue}}else if(n.isDirectory()){const m=await l(x,y);Object.assign(w,m)}}}return w}const C=await l("/");return o.runner.handleDeployAction("deploying","complete",{source:"github"}),N.success("ðŸš€ GitHub deployment preparation completed successfully!"),{success:!0,files:C,projectName:e.title||"devonz-project"}}catch(e){return console.error("GitHub deploy error:",e),N.error(e instanceof Error?e.message:"GitHub deployment preparation failed"),!1}finally{c(!1)}},isConnected:!!V("github_connection")?.user}}function me(){const[i,c]=f.useState(!1),s=I(_);return{isDeploying:i,handleGitLabDeploy:async()=>{const S=V("gitlab_connection");if(!S?.token||!S?.user)return N.error("Please connect your GitLab account in Settings > Connections first"),!1;if(!s)return N.error("No active chat found"),!1;try{c(!0);const e=F.firstArtifact;if(!e)throw new Error("No active project found");const d="deploy-gitlab-project";F.addArtifact({id:d,messageId:d,title:"GitLab Deployment",type:"standalone"});const o=F.artifacts.get()[d];o.runner.handleDeployAction("building","running",{source:"gitlab"});const A="build-"+Date.now(),u={messageId:"gitlab build",artifactId:e.id,actionId:A,action:{type:"build",content:"npm run build"}};if(e.runner.addAction(u),await e.runner.runAction(u),!e.runner.buildOutput)throw o.runner.handleDeployAction("building","failed",{error:"Build failed. Check the terminal for details.",source:"gitlab"}),new Error("Build failed");o.runner.handleDeployAction("deploying","running",{source:"gitlab"});const r=await B;async function l(p,g=""){const w={},D=await r.fs.readdir(p,{withFileTypes:!0});for(const n of D){const x=T.join(p,n.name),y=g?`${g}/${n.name}`:n.name;if(!(n.isDirectory()&&(n.name==="node_modules"||n.name===".git"||n.name==="dist"||n.name==="build"||n.name===".cache"||n.name===".next"))){if(n.isFile()){if(n.name.endsWith(".DS_Store")||n.name.endsWith(".log")||n.name.startsWith(".env"))continue;try{const m=await r.fs.readFile(x,"utf-8");w[y]=m}catch(m){console.warn(`Could not read file ${x}:`,m);continue}}else if(n.isDirectory()){const m=await l(x,y);Object.assign(w,m)}}}return w}const C=await l("/");return o.runner.handleDeployAction("deploying","complete",{source:"gitlab"}),N.success("ðŸš€ GitLab deployment preparation completed successfully!"),{success:!0,files:C,projectName:e.title||"devonz-project"}}catch(e){return console.error("GitLab deploy error:",e),N.error(e instanceof Error?e.message:"GitLab deployment preparation failed"),!1}finally{c(!1)}},isConnected:!!V("gitlab_connection")?.user}}const he=f.lazy(()=>U(()=>import("./GitHubDeploymentDialog-HKJ7qUwC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(i=>({default:i.GitHubDeploymentDialog}))),be=f.lazy(()=>U(()=>import("./GitLabDeploymentDialog-CxNPU6BM.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,8,9,10,12])).then(i=>({default:i.GitLabDeploymentDialog}))),ke=({onVercelDeploy:i,onNetlifyDeploy:c,onGitHubDeploy:s,onGitLabDeploy:a})=>{const S=I(W),e=I(z),d=I(oe),[o]=f.useState(0),u=I(F.previews)[o],[r,l]=f.useState(!1),[C,p]=f.useState(null),g=I(re),{handleVercelDeploy:w}=pe(),{handleNetlifyDeploy:D}=fe(),{handleGitHubDeploy:n}=ye(),{handleGitLabDeploy:x}=me(),[y,m]=f.useState(!1),[v,h]=f.useState(!1),[j,b]=f.useState(null),[k,P]=f.useState(null),[G,E]=f.useState(""),[H,Y]=f.useState(""),Z=async()=>{l(!0),p("vercel");try{i?await i():await w()}finally{l(!1),p(null)}},ee=async()=>{l(!0),p("netlify");try{c?await c():await D()}finally{l(!1),p(null)}},te=async()=>{l(!0),p("github");try{if(s)await s();else{const $=await n();$&&$.success&&$.files&&(b($.files),E($.projectName),m(!0))}}finally{l(!1),p(null)}},ne=async()=>{l(!0),p("gitlab");try{if(a)await a();else{const $=await x();$&&$.success&&$.files&&(P($.files),Y($.projectName),h(!0))}}finally{l(!1),p(null)}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"relative flex border border-bolt-elements-borderColor rounded-md overflow-hidden text-sm",children:t.jsxs(ie,{children:[t.jsxs(se,{disabled:r||!u||g,className:"rounded-md items-center justify-center [&:is(:disabled,.disabled)]:cursor-not-allowed [&:is(:disabled,.disabled)]:opacity-60 px-3 py-1.5 text-xs bg-bolt-elements-background-depth-3 text-bolt-elements-textPrimary border border-bolt-elements-borderColor hover:bg-bolt-elements-background-depth-4 [&:not(:disabled,.disabled)]:hover:text-accent-400 outline-accent-500 flex gap-1.7",children:[r?`Deploying to ${C}...`:"Deploy",t.jsx("span",{className:O("i-ph:caret-down transition-transform")})]}),t.jsx(le,{children:t.jsxs(ae,{className:O("z-[9999]","bg-bolt-elements-background-depth-2","rounded-lg shadow-lg","border border-bolt-elements-borderColor","animate-in fade-in-0 zoom-in-95","py-1"),sideOffset:5,align:"end",children:[t.jsxs(L,{className:O("cursor-pointer flex items-center w-full px-4 py-2 text-sm text-bolt-elements-textPrimary hover:bg-bolt-elements-item-backgroundActive gap-2 rounded-md group relative",{"opacity-60 cursor-not-allowed":r||!u||!S.user}),disabled:r||!u||!S.user,onClick:ee,children:[t.jsx("img",{className:"w-5 h-5",height:"24",width:"24",crossOrigin:"anonymous",src:"https://cdn.simpleicons.org/netlify",alt:"Netlify"}),t.jsx("span",{className:"mx-auto",children:S.user?"Deploy to Netlify":"No Netlify Account Connected"}),S.user&&t.jsx(de,{})]}),t.jsxs(L,{className:O("cursor-pointer flex items-center w-full px-4 py-2 text-sm text-bolt-elements-textPrimary hover:bg-bolt-elements-item-backgroundActive gap-2 rounded-md group relative",{"opacity-60 cursor-not-allowed":r||!u||!e.user}),disabled:r||!u||!e.user,onClick:Z,children:[t.jsx("img",{className:"w-5 h-5 bg-black p-1 rounded",height:"24",width:"24",crossOrigin:"anonymous",src:"https://cdn.simpleicons.org/vercel/white",alt:"vercel"}),t.jsx("span",{className:"mx-auto",children:e.user?"Deploy to Vercel":"No Vercel Account Connected"}),e.user&&t.jsx(ue,{})]}),t.jsxs(L,{className:O("cursor-pointer flex items-center w-full px-4 py-2 text-sm text-bolt-elements-textPrimary hover:bg-bolt-elements-item-backgroundActive gap-2 rounded-md group relative",{"opacity-60 cursor-not-allowed":r||!u}),disabled:r||!u,onClick:te,children:[t.jsx("img",{className:"w-5 h-5",height:"24",width:"24",crossOrigin:"anonymous",src:"https://cdn.simpleicons.org/github",alt:"github"}),t.jsx("span",{className:"mx-auto",children:"Deploy to GitHub"})]}),t.jsxs(L,{className:O("cursor-pointer flex items-center w-full px-4 py-2 text-sm text-bolt-elements-textPrimary hover:bg-bolt-elements-item-backgroundActive gap-2 rounded-md group relative",{"opacity-60 cursor-not-allowed":r||!u||!d}),disabled:r||!u||!d,onClick:ne,children:[t.jsx("img",{className:"w-5 h-5",height:"24",width:"24",crossOrigin:"anonymous",src:"https://cdn.simpleicons.org/gitlab",alt:"gitlab"}),t.jsx("span",{className:"mx-auto",children:d?"Deploy to GitLab":"No GitLab Account Connected"})]}),t.jsxs(L,{disabled:!0,className:"flex items-center w-full rounded-md px-4 py-2 text-sm text-bolt-elements-textTertiary gap-2 opacity-60 cursor-not-allowed",children:[t.jsx("img",{className:"w-5 h-5",height:"24",width:"24",crossOrigin:"anonymous",src:"https://cdn.simpleicons.org/cloudflare",alt:"Cloudflare"}),t.jsx("span",{className:"mx-auto",children:"Deploy to Cloudflare (Coming Soon)"})]})]})})]})}),y&&j&&t.jsx(f.Suspense,{fallback:null,children:t.jsx(he,{isOpen:y,onClose:()=>m(!1),projectName:G,files:j})}),v&&k&&t.jsx(f.Suspense,{fallback:null,children:t.jsx(be,{isOpen:v,onClose:()=>h(!1),projectName:H,files:k})})]})};export{ke as DeployButton};
