import{c as S,a as Y,s as $,b as K,p as Q,A as M,f as J,d as W}from"./Header-C4AWQck-.js";import{u as m,s as n,i as T,c as Z,l as ee,n as te,a as g,b as v,r as b,d as f,o,e as u,f as R,g as l}from"./mobile-BXmnRaCS.js";var ae=Object.defineProperty,C=(e,a)=>{for(var r in a)ae(e,r,{get:a[r],enumerable:!0})};function q(e,{contentType:a,dataStreamVersion:r}){const t=new Headers(e??{});return t.has("Content-Type")||t.set("Content-Type",a),t.set("X-Vercel-AI-Data-Stream",r),t}var F="AI_NoObjectGeneratedError",U=`vercel.ai.error.${F}`,re=Symbol.for(U),z,N=class extends M{constructor({message:e="No object generated.",cause:a,text:r,response:t,usage:s,finishReason:i}){super({name:F,message:e,cause:a}),this[z]=!0,this.text=r,this.response=t,this.usage=s,this.finishReason=i}static isInstance(e){return M.hasMarker(e,U)}};z=re;var V=m([n(),T(Uint8Array),T(ArrayBuffer),Z(e=>{var a,r;return(r=(a=globalThis.Buffer)==null?void 0:a.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]),O=ee(()=>m([te(),n(),g(),v(),b(n(),O),f(O)])),p=b(n(),b(n(),O)),ne=f(m([o({type:u("text"),text:n()}),o({type:u("image"),data:n(),mimeType:n().optional()})])),B=o({type:u("text"),text:n(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),oe=o({type:u("image"),image:m([V,T(URL)]),mimeType:n().optional(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),H=o({type:u("file"),data:m([V,T(URL)]),filename:n().optional(),mimeType:n(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),se=o({type:u("reasoning"),text:n(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),ie=o({type:u("redacted-reasoning"),data:n(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),pe=o({type:u("tool-call"),toolCallId:n(),toolName:n(),args:R(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),ue=o({type:u("tool-result"),toolCallId:n(),toolName:n(),result:R(),content:ne.optional(),isError:v().optional(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),le=o({role:u("system"),content:n(),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),ce=o({role:u("user"),content:m([n(),f(m([B,oe,H]))]),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),me=o({role:u("assistant"),content:m([n(),f(m([B,H,se,ie,pe]))]),providerOptions:p.optional(),experimental_providerMetadata:p.optional()}),de=o({role:u("tool"),content:f(ue),providerOptions:p.optional(),experimental_providerMetadata:p.optional()});m([le,ce,me,de]);var he="JSON schema:",ve="You MUST answer with a JSON object that matches the JSON schema above.",fe="You MUST answer with JSON.";function Se({prompt:e,schema:a,schemaPrefix:r=a!=null?he:void 0,schemaSuffix:t=a!=null?ve:fe}){return[e!=null&&e.length>0?e:void 0,e!=null&&e.length>0?"":void 0,r,a!=null?JSON.stringify(a):void 0,t].filter(s=>s!=null).join(`
`)}S({prefix:"aiobj",size:24});S({prefix:"aiobj",size:24});S({prefix:"aitxt",size:24});S({prefix:"msg",size:24});var ge={};C(ge,{object:()=>xe,text:()=>ye});var ye=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:e}){return e},parsePartial({text:e}){return{partial:e}},parseOutput({text:e}){return e}}),xe=({schema:e})=>{const a=Y(e);return{type:"object",responseFormat:({model:r})=>({type:"json",schema:r.supportsStructuredOutputs?a.jsonSchema:void 0}),injectIntoSystemPrompt({system:r,model:t}){return t.supportsStructuredOutputs?r:Se({prompt:r,schema:a.jsonSchema})},parsePartial({text:r}){const t=Q(r);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{const s=t.state;throw new Error(`Unsupported parse state: ${s}`)}}},parseOutput({text:r},t){const s=$({text:r});if(!s.success)throw new N({message:"No object generated: could not parse the response.",cause:s.error,text:r,response:t.response,usage:t.usage,finishReason:t.finishReason});const i=K({value:s.value,schema:a});if(!i.success)throw new N({message:"No object generated: response did not match schema.",cause:i.error,text:r,response:t.response,usage:t.usage,finishReason:t.finishReason});return i.value}}};function L(e,a){const r=e.getReader(),t=a.getReader();let s,i,h=!1,x=!1;async function D(d){try{s==null&&(s=r.read());const c=await s;s=void 0,c.done?d.close():d.enqueue(c.value)}catch(c){d.error(c)}}async function E(d){try{i==null&&(i=t.read());const c=await i;i=void 0,c.done?d.close():d.enqueue(c.value)}catch(c){d.error(c)}}return new ReadableStream({async pull(d){try{if(h){await E(d);return}if(x){await D(d);return}s==null&&(s=r.read()),i==null&&(i=t.read());const{result:c,reader:k}=await Promise.race([s.then(_=>({result:_,reader:r})),i.then(_=>({result:_,reader:t}))]);c.done||d.enqueue(c.value),k===r?(s=void 0,c.done&&(await E(d),h=!0)):(i=void 0,c.done&&(x=!0,await D(d)))}catch(c){d.error(c)}},cancel(){r.cancel(),t.cancel()}})}S({prefix:"aitxt",size:24});S({prefix:"msg",size:24});var Te=o({name:n(),version:n()}).passthrough(),I=o({_meta:l(o({}).passthrough())}).passthrough(),y=I,Re=o({method:n(),params:l(I)}),we=o({experimental:l(o({}).passthrough()),logging:l(o({}).passthrough()),prompts:l(o({listChanged:l(v())}).passthrough()),resources:l(o({subscribe:l(v()),listChanged:l(v())}).passthrough()),tools:l(o({listChanged:l(v())}).passthrough())}).passthrough();y.extend({protocolVersion:n(),capabilities:we,serverInfo:Te,instructions:l(n())});var _e=y.extend({nextCursor:l(n())}),be=o({name:n(),description:l(n()),inputSchema:o({type:u("object"),properties:l(o({}).passthrough())}).passthrough()}).passthrough();_e.extend({tools:f(be)});var Oe=o({type:u("text"),text:n()}).passthrough(),Ce=o({type:u("image"),data:n().base64(),mimeType:n()}).passthrough(),G=o({uri:n(),mimeType:l(n())}).passthrough(),Ie=G.extend({text:n()}),je=G.extend({blob:n().base64()}),Pe=o({type:u("resource"),resource:m([Ie,je])}).passthrough();y.extend({content:f(m([Oe,Ce,Pe])),isError:v().default(!1).optional()}).or(y.extend({toolResult:R()}));var w="2.0",De=o({jsonrpc:u(w),id:m([n(),g().int()])}).merge(Re).strict(),Ee=o({jsonrpc:u(w),id:m([n(),g().int()]),result:y}).strict(),Me=o({jsonrpc:u(w),id:m([n(),g().int()]),error:o({code:g().int(),message:n(),data:l(R())})}).strict(),Ne=o({jsonrpc:u(w)}).merge(o({method:n(),params:l(I)})).strict();m([De,Ne,Ee,Me]);var Ae={};C(Ae,{mergeIntoDataStream:()=>Fe,toDataStream:()=>Je,toDataStreamResponse:()=>qe});function X(e={}){const a=new TextEncoder;let r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(t,s){s.enqueue(a.encode(t)),r+=t,e.onToken&&await e.onToken(t),e.onText&&typeof t=="string"&&await e.onText(t)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function j(e,a){return e.pipeThrough(new TransformStream({transform:async(r,t)=>{var s;if(typeof r=="string"){t.enqueue(r);return}if("event"in r){r.event==="on_chat_model_stream"&&A((s=r.data)==null?void 0:s.chunk,t);return}A(r,t)}})).pipeThrough(X(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,t)=>{t.enqueue(J("text",r))}}))}function Je(e,a){return j(e,a).pipeThrough(new TextEncoderStream)}function qe(e,a){var r;const t=j(e,a?.callbacks).pipeThrough(new TextEncoderStream),s=a?.data,i=a?.init,h=s?L(s.stream,t):t;return new Response(h,{status:(r=i?.status)!=null?r:200,statusText:i?.statusText,headers:q(i?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Fe(e,a){a.dataStream.merge(j(e,a.callbacks))}function A(e,a){if(typeof e.content=="string")a.enqueue(e.content);else{const r=e.content;for(const t of r)t.type==="text"&&a.enqueue(t.text)}}var Ue={};C(Ue,{mergeIntoDataStream:()=>Be,toDataStream:()=>ze,toDataStreamResponse:()=>Ve});function P(e,a){const r=He();return W(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(t,s){s.enqueue(r(t.delta))}})).pipeThrough(X(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(t,s)=>{s.enqueue(J("text",t))}}))}function ze(e,a){return P(e,a).pipeThrough(new TextEncoderStream)}function Ve(e,a={}){var r;const{init:t,data:s,callbacks:i}=a,h=P(e,i).pipeThrough(new TextEncoderStream),x=s?L(s.stream,h):h;return new Response(x,{status:(r=t?.status)!=null?r:200,statusText:t?.statusText,headers:q(t?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Be(e,a){a.dataStream.merge(P(e,a.callbacks))}function He(){let e=!0;return a=>(e&&(a=a.trimStart(),a&&(e=!1)),a)}
